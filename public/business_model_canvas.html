<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Model Canvas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .btn-primary {
      background: #00d4ff;
      color: #000;
    }

    .btn-primary:hover {
      background: #00b8e0;
    }

    .analytics-panel {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      width: 95%;
      max-width: 1400px;
    }

    .analytics-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .analytics-controls {
      display: flex;
      gap: 10px;
    }

    .analytics-panel h2 {
      color: #00d4ff;
      margin-bottom: 15px;
    }

    .chart-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .chart-wrapper {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      width: 45%;
      min-width: 300px;
    }

    .canvas-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 20px;
      width: 95%;
      max-width: 1400px;
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }

    .card {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: move;
      user-select: none;
    }

    .card.dragging {
      opacity: 0.5;
      transform: scale(1.05);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: translateX(-100%);
      transition: 0.5s;
    }

    .card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .card:hover::before {
      transform: translateX(100%);
    }

    .card h3 {
      font-size: 1.4rem;
      margin-bottom: 15px;
      color: #00d4ff;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .card p {
      font-size: 1rem;
      line-height: 1.6;
      color: #e0e0e0;
      margin-bottom: 15px;
    }

    .card .edit-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .card:hover .edit-btn {
      opacity: 1;
    }

    .validation-message {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 0, 0, 0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
      display: none;
    }

    .card.invalid .validation-message {
      display: block;
    }

    @media (max-width: 1200px) {
      .canvas-container {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(4, 1fr);
      }

      .key-partners {
        grid-column: 1 / 2;
        grid-row: 1 / 2;
      }

      .key-activities {
        grid-column: 2 / 3;
        grid-row: 1 / 2;
      }

      .value-propositions {
        grid-column: 1 / 2;
        grid-row: 2 / 3;
      }

      .customer-relationships {
        grid-column: 2 / 3;
        grid-row: 2 / 3;
      }

      .channels {
        grid-column: 1 / 3;
        grid-row: 3 / 4;
      }

      .revenue-streams {
        grid-column: 1 / 2;
        grid-row: 4 / 5;
      }

      .cost-structure {
        grid-column: 2 / 3;
        grid-row: 4 / 5;
      }
    }

    @media (max-width: 768px) {
      .canvas-container {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(7, auto);
      }

      .card {
        grid-column: 1 / 2;
      }

      .key-partners { grid-row: 1 / 2; }
      .key-activities { grid-row: 2 / 3; }
      .value-propositions { grid-row: 3 / 4; }
      .customer-relationships { grid-row: 4 / 5; }
      .channels { grid-row: 5 / 6; }
      .revenue-streams { grid-row: 6 / 7; }
      .cost-structure { grid-row: 7 / 8; }

      .chart-wrapper {
        width: 100%;
      }
    }

    .suggestions-panel {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      width: 95%;
      max-width: 1400px;
    }

    .suggestions-panel h2 {
      color: #00d4ff;
      margin-bottom: 15px;
    }

    .suggestions-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .suggestion-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
    }

    .suggestion-card h3 {
      color: #00d4ff;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }

    .suggestion-content {
      color: #e0e0e0;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .suggestion-item {
      margin-bottom: 8px;
      padding: 5px;
      border-radius: 5px;
      background: rgba(0, 212, 255, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .suggestion-item:hover {
      background: rgba(0, 212, 255, 0.2);
      transform: translateX(5px);
    }

    .learning-panel {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      width: 95%;
      max-width: 1400px;
    }

    .learning-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      background: #00d4ff;
      color: #000;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .section-guide {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .guide-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
    }

    .guide-item h5 {
      color: #00d4ff;
      margin-bottom: 10px;
    }

    .example-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .example-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
    }

    .example-card h4 {
      color: #00d4ff;
      margin-bottom: 10px;
    }

    .example-card ul {
      list-style-type: none;
      padding: 0;
    }

    .example-card li {
      margin-bottom: 8px;
      padding: 5px;
      background: rgba(0, 212, 255, 0.1);
      border-radius: 5px;
    }

    .tutorial-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .tutorial-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
    }

    .quiz-container {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
    }

    .quiz-question {
      margin-bottom: 20px;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .quiz-options label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .analysis-report {
      margin-top: 30px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
    }

    .report-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .report-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      position: relative;
    }

    .report-section h4 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #00d4ff;
      margin-bottom: 10px;
    }

    .section-score {
      background: rgba(0, 212, 255, 0.2);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.8rem;
    }

    .risk-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .risk-low { background-color: #4CAF50; }
    .risk-medium { background-color: #FFC107; }
    .risk-high { background-color: #F44336; }

    .sentiment-bar {
      height: 5px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      margin-top: 10px;
      overflow: hidden;
    }

    .sentiment-fill {
      height: 100%;
      background: linear-gradient(90deg, #F44336, #FFC107, #4CAF50);
      transition: width 0.3s ease;
    }

    .report-content {
      color: #e0e0e0;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100px;
    }

    .loading::after {
      content: '';
      width: 30px;
      height: 30px;
      border: 3px solid #00d4ff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .gamification-panel {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      width: 95%;
      max-width: 1400px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .gamification-stats {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .stat-item {
      text-align: center;
      padding: 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .stat-item:hover {
      background: rgba(0, 212, 255, 0.1);
      transform: translateY(-5px);
    }

    .stat-value {
      display: block;
      font-size: 2.5rem;
      color: #00d4ff;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 1rem;
      color: #e0e0e0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .achievements-container {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .achievement-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      position: relative;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .achievement-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: translateX(-100%);
      transition: 0.5s;
    }

    .achievement-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }

    .achievement-card:hover::before {
      transform: translateX(100%);
    }

    .achievement-card.locked {
      opacity: 0.7;
      filter: grayscale(50%);
    }

    .achievement-card.unlocked {
      border: 1px solid #00d4ff;
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
    }

    .achievement-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
    }

    .achievement-title {
      font-size: 1.2rem;
      color: #00d4ff;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .achievement-description {
      font-size: 0.9rem;
      color: #e0e0e0;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .achievement-progress {
      height: 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      margin: 15px 0;
      overflow: hidden;
    }

    .achievement-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00d4ff, #00a8ff);
      transition: width 0.5s ease;
    }

    .achievement-reward {
      background: rgba(0, 212, 255, 0.2);
      color: #00d4ff;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-block;
      margin-top: 10px;
    }

    .leaderboard {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
    }

    .leaderboard-list {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .leaderboard-item:hover {
      background: rgba(0, 212, 255, 0.1);
    }

    .leaderboard-item:last-child {
      border-bottom: none;
    }

    .leaderboard-rank {
      font-size: 1.2rem;
      font-weight: bold;
      color: #00d4ff;
      width: 40px;
      text-align: center;
    }

    .leaderboard-name {
      flex: 1;
      margin: 0 20px;
    }

    .leaderboard-score {
      font-weight: bold;
      color: #00d4ff;
    }

    .daily-challenges {
      margin-top: 30px;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
    }

    .challenges-list {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
    }

    .challenge-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .challenge-item:hover {
      background: rgba(0, 212, 255, 0.1);
    }

    .challenge-item:last-child {
      border-bottom: none;
    }

    .challenge-info {
      flex: 1;
      margin-right: 20px;
    }

    .challenge-title {
      font-size: 1.1rem;
      color: #00d4ff;
      margin-bottom: 5px;
    }

    .challenge-description {
      font-size: 0.9rem;
      color: #e0e0e0;
    }

    .challenge-reward {
      background: linear-gradient(90deg, #00d4ff, #00a8ff);
      color: #000;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      min-width: 80px;
      text-align: center;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(90deg, #00d4ff, #00a8ff);
      color: #000;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .notification-icon {
      font-size: 1.5rem;
    }

    .notification-content {
      font-weight: 600;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    .progress-ring {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .progress-ring-circle {
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
      transition: stroke-dashoffset 0.5s ease;
    }

    .progress-ring-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.2rem;
      font-weight: bold;
      color: #00d4ff;
    }

    .tab-navigation {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 10px;
    }

    .tab-button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tab-button:hover {
      background: rgba(0, 212, 255, 0.2);
    }

    .tab-button.active {
      background: #00d4ff;
      color: #000;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .welcome-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 800px;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: popIn 0.5s ease;
    }

    @keyframes popIn {
      from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    .welcome-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .welcome-header h2 {
      color: #00d4ff;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .welcome-header p {
      color: #e0e0e0;
      font-size: 1.1rem;
    }

    .welcome-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .welcome-section {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .welcome-section h3 {
      color: #00d4ff;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    .welcome-section ul {
      list-style: none;
      padding: 0;
    }

    .welcome-section li {
      color: #e0e0e0;
      margin-bottom: 10px;
      padding-left: 25px;
      position: relative;
      line-height: 1.4;
    }

    .welcome-section li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: #00d4ff;
    }

    .welcome-footer {
      text-align: center;
      margin-top: 30px;
    }

    .welcome-btn {
      background: linear-gradient(90deg, #00d4ff, #00a8ff);
      color: #000;
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .welcome-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 999;
    }
  </style>
</head>

<body>
  <div class="overlay" id="overlay"></div>
  <div class="welcome-popup" id="welcomePopup">
    <div class="welcome-header">
      <h2>Welcome to Business Model Canvas</h2>
      <p>Your comprehensive tool for business model development and analysis</p>
    </div>
    <div class="welcome-content">
      <div class="welcome-section">
        <h3>What is BMC?</h3>
        <ul>
          <li>A strategic management template for developing new or documenting existing business models</li>
          <li>Visual chart describing a firm's value proposition, infrastructure, customers, and finances</li>
          <li>Helps align activities by illustrating potential trade-offs</li>
          <li>Used by startups and established companies worldwide</li>
        </ul>
      </div>
      <div class="welcome-section">
        <h3>Tool Benefits</h3>
        <ul>
          <li>AI-powered suggestions for each canvas section</li>
          <li>Real-time analysis and validation</li>
          <li>Interactive learning resources and examples</li>
          <li>Gamification features to track progress</li>
          <li>Export options for sharing and documentation</li>
          <li>Customizable templates for different business types</li>
        </ul>
      </div>
    </div>
    <div class="welcome-footer">
      <button class="welcome-btn" id="startBtn">Get Started</button>
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-primary" id="exportBtn">Export Canvas</button>
    <button class="btn" id="importBtn">Import Canvas</button>
    <input type="file" id="importInput" style="display: none" accept=".json">
    <select class="btn" id="templateSelect">
      <option value="">Select Template</option>
      <option value="startup">Startup</option>
      <option value="saas">SaaS</option>
      <option value="ecommerce">E-commerce</option>
    </select>
    <button class="btn" id="analyzeBtn">Analyze Canvas</button>
    <button class="btn" id="exportPdfBtn">Export as PDF</button>
    <button class="btn" id="suggestionsBtn">Get Suggestions</button>
    <button class="btn" id="learnBtn">Learn More</button>
    <button class="btn" id="achievementsBtn">Achievements</button>
  </div>

  <div class="analytics-panel" id="analyticsPanel" style="display: none;">
    <div class="analytics-header">
      <h2>Canvas Analytics</h2>
      <div class="analytics-controls">
        <button class="btn" id="exportReportBtn">Export Report</button>
        <button class="btn" id="refreshAnalysisBtn">Refresh Analysis</button>
      </div>
    </div>

    <div class="chart-container">
      <div class="chart-wrapper">
        <canvas id="completenessChart"></canvas>
      </div>
      <div class="chart-wrapper">
        <canvas id="wordCountChart"></canvas>
      </div>
    </div>
    
    <div class="analysis-report" id="analysisReport">
      <div class="report-sections">
        <div class="report-section">
          <h4>Business Overview</h4>
          <div class="report-content" id="businessOverview"></div>
        </div>
        <div class="report-section">
          <h4>Industry Analysis</h4>
          <div class="report-content" id="industryAnalysis"></div>
        </div>
        <div class="report-section">
          <h4>Strengths & Opportunities</h4>
          <div class="report-content" id="strengthsOpportunities"></div>
        </div>
        <div class="report-section">
          <h4>Weaknesses & Threats</h4>
          <div class="report-content" id="weaknessesThreats"></div>
        </div>
        <div class="report-section">
          <h4>Market Analysis</h4>
          <div class="report-content" id="marketAnalysis"></div>
        </div>
        <div class="report-section">
          <h4>Competitive Analysis</h4>
          <div class="report-content" id="competitiveAnalysis"></div>
        </div>
        <div class="report-section">
          <h4>Financial Viability</h4>
          <div class="report-content" id="financialViability"></div>
        </div>
        <div class="report-section">
          <h4>Sentiment Analysis</h4>
          <div class="report-content" id="sentimentAnalysis"></div>
        </div>
        <div class="report-section">
          <h4>Risk Assessment</h4>
          <div class="report-content" id="riskAssessment"></div>
        </div>
        <div class="report-section">
          <h4>Strategic Recommendations</h4>
          <div class="report-content" id="recommendations"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="gamification-panel" id="gamificationPanel" style="display: none;">
    <h2>Your Progress</h2>
    <div class="gamification-stats">
      <div class="stat-item">
        <span class="stat-value" id="completionScore">0%</span>
        <span class="stat-label">Canvas Completion</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="experiencePoints">0</span>
        <span class="stat-label">Experience Points</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="achievementCount">0</span>
        <span class="stat-label">Achievements</span>
      </div>
    </div>

    <div class="tab-navigation">
      <button class="tab-button active" data-tab="achievements">Achievements</button>
      <button class="tab-button" data-tab="challenges">Challenges</button>
      <button class="tab-button" data-tab="leaderboard">Leaderboard</button>
    </div>

    <div class="achievements-container">
      <h3>Available Achievements</h3>
      <div class="achievements-grid" id="achievementsGrid"></div>
    </div>

    <div class="leaderboard">
      <h3>Top Performers</h3>
      <div class="leaderboard-list" id="leaderboardList"></div>
    </div>

    <div class="daily-challenges">
      <h3>Daily Challenges</h3>
      <div class="challenges-list" id="challengesList"></div>
    </div>
  </div>

  <div class="suggestions-panel" id="suggestionsPanel" style="display: none;">
    <h2>AI Suggestions</h2>
    <div class="suggestions-container">
      <div class="suggestion-card">
        <h3>Key Partners Suggestions</h3>
        <div class="suggestion-content" id="partnersSuggestions"></div>
      </div>
      <div class="suggestion-card">
        <h3>Key Activities Suggestions</h3>
        <div class="suggestion-content" id="activitiesSuggestions"></div>
      </div>
      <div class="suggestion-card">
        <h3>Value Propositions Suggestions</h3>
        <div class="suggestion-content" id="propositionsSuggestions"></div>
      </div>
      <div class="suggestion-card">
        <h3>Customer Relationships Suggestions</h3>
        <div class="suggestion-content" id="relationshipsSuggestions"></div>
      </div>
      <div class="suggestion-card">
        <h3>Channels Suggestions</h3>
        <div class="suggestion-content" id="channelsSuggestions"></div>
      </div>
      <div class="suggestion-card">
        <h3>Revenue Streams Suggestions</h3>
        <div class="suggestion-content" id="revenueSuggestions"></div>
      </div>
      <div class="suggestion-card">
        <h3>Cost Structure Suggestions</h3>
        <div class="suggestion-content" id="costSuggestions"></div>
      </div>
    </div>
  </div>

  <div class="learning-panel" id="learningPanel" style="display: none;">
    <h2>Business Model Canvas Learning Resources</h2>
    <div class="learning-tabs">
      <button class="tab-btn active" data-tab="overview">Overview</button>
      <button class="tab-btn" data-tab="examples">Examples</button>
      <button class="tab-btn" data-tab="tutorials">Tutorials</button>
      <button class="tab-btn" data-tab="quiz">Quiz</button>
    </div>
    
    <div class="tab-content active" id="overview">
      <h3>What is a Business Model Canvas?</h3>
      <p>The Business Model Canvas is a strategic management template used for developing new or documenting existing business models. It's a visual chart with elements describing a firm's value proposition, infrastructure, customers, and finances.</p>
      
      <div class="section-guide">
        <h4>Key Components:</h4>
        <div class="guide-item">
          <h5>Key Partners</h5>
          <p>Who are your key partners/suppliers? What key resources are you acquiring from partners?</p>
        </div>
        <div class="guide-item">
          <h5>Key Activities</h5>
          <p>What key activities do your value propositions require? What activities are most important?</p>
        </div>
        <div class="guide-item">
          <h5>Value Propositions</h5>
          <p>What value do you deliver to customers? Which customer problems are you helping to solve?</p>
        </div>
        <div class="guide-item">
          <h5>Customer Relationships</h5>
          <p>What type of relationship does each customer segment expect you to establish?</p>
        </div>
        <div class="guide-item">
          <h5>Channels</h5>
          <p>Through which channels do your customer segments want to be reached?</p>
        </div>
        <div class="guide-item">
          <h5>Revenue Streams</h5>
          <p>For what value are your customers willing to pay? How do they prefer to pay?</p>
        </div>
        <div class="guide-item">
          <h5>Cost Structure</h5>
          <p>What are the most important costs inherent in your business model?</p>
        </div>
      </div>
    </div>

    <div class="tab-content" id="examples">
      <h3>Real-World Examples</h3>
      <div class="example-cards">
        <div class="example-card">
          <h4>Airbnb</h4>
          <ul>
            <li>Key Partners: Property owners, payment processors</li>
            <li>Key Activities: Platform maintenance, community management</li>
            <li>Value Propositions: Unique accommodations, local experiences</li>
            <li>Customer Relationships: Community building, trust systems</li>
            <li>Channels: Website, mobile app, social media</li>
            <li>Revenue Streams: Service fees, premium listings</li>
            <li>Cost Structure: Platform development, marketing, operations</li>
          </ul>
        </div>
        <div class="example-card">
          <h4>Uber</h4>
          <ul>
            <li>Key Partners: Drivers, payment processors, maps providers</li>
            <li>Key Activities: App development, driver recruitment</li>
            <li>Value Propositions: Convenient transportation, cashless payment</li>
            <li>Customer Relationships: Rating system, customer support</li>
            <li>Channels: Mobile app, website, partnerships</li>
            <li>Revenue Streams: Ride commissions, surge pricing</li>
            <li>Cost Structure: Driver incentives, platform maintenance</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tutorials">
      <h3>Video Tutorials</h3>
      <div class="tutorial-grid">
        <div class="tutorial-card">
          <h4>Introduction to BMC</h4>
          <iframe width="100%" height="200" src="https://www.youtube.com/embed/QoAOzMTLP5s" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="tutorial-card">
          <h4>How to Fill Out BMC</h4>
          <iframe width="100%" height="200" src="https://www.youtube.com/embed/7aE9Xb9d5Zk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>
    </div>

    <div class="tab-content" id="quiz">
      <h3>Test Your Knowledge</h3>
      <div class="quiz-container">
        <div class="quiz-question">
          <p>1. What is the purpose of the Key Partners section?</p>
          <div class="quiz-options">
            <label><input type="radio" name="q1" value="a"> To list all suppliers</label>
            <label><input type="radio" name="q1" value="b"> To identify strategic alliances</label>
            <label><input type="radio" name="q1" value="c"> To track customer relationships</label>
          </div>
        </div>
        <div class="quiz-question">
          <p>2. Which section focuses on how you deliver value to customers?</p>
          <div class="quiz-options">
            <label><input type="radio" name="q2" value="a"> Value Propositions</label>
            <label><input type="radio" name="q2" value="b"> Revenue Streams</label>
            <label><input type="radio" name="q2" value="c"> Customer Relationships</label>
          </div>
        </div>
        <button class="btn" id="submitQuiz">Submit Answers</button>
      </div>
    </div>
  </div>

  <div class="canvas-container">
    <div class="card key-partners" draggable="true">
      <h3>Key Partners</h3>
      <p>Gemini Exchange, Payment Gateways, Banking Partners, Compliance Advisors</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 3 partners required</div>
    </div>
    <div class="card key-activities" draggable="true">
      <h3>Key Activities</h3>
      <p>Fetching market data, Executing trades, Monitoring compliance</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 3 activities required</div>
    </div>
    <div class="card value-propositions" draggable="true">
      <h3>Value Propositions</h3>
      <p>Seamless integration with crypto markets, reliable API access</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 2 value propositions required</div>
    </div>
    <div class="card customer-relationships" draggable="true">
      <h3>Customer Relationships</h3>
      <p>24/7 support, personalized solutions, secure transactions</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 2 relationship types required</div>
    </div>
    <div class="card channels" draggable="true">
      <h3>Channels</h3>
      <p>Web platform, API integrations, mobile app</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 2 channels required</div>
    </div>
    <div class="card revenue-streams" draggable="true">
      <h3>Revenue Streams</h3>
      <p>Transaction fees, Subscription plans, Premium features</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 2 revenue streams required</div>
    </div>
    <div class="card cost-structure" draggable="true">
      <h3>Cost Structure</h3>
      <p>API development, Compliance management, Operational costs</p>
      <button class="edit-btn">Edit</button>
      <div class="validation-message">Minimum 3 cost categories required</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // WebSocket connection
    const ws = new WebSocket('ws://localhost:3000');
    let isConnected = false;

    ws.onopen = () => {
      isConnected = true;
      console.log('Connected to WebSocket server');
    };

    ws.onclose = () => {
      isConnected = false;
      console.log('Disconnected from WebSocket server');
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'update') {
        const card = document.querySelector(`.${data.id}`);
        if (card) {
          card.querySelector('p').textContent = data.content;
        }
      } else if (data.type === 'reorder') {
        const cards = Array.from(document.querySelectorAll('.card'));
        const card = document.querySelector(`.${data.id}`);
        if (card) {
          const targetIndex = data.index;
          const currentIndex = cards.indexOf(card);
          if (currentIndex !== targetIndex) {
            if (currentIndex < targetIndex) {
              card.parentNode.insertBefore(card, cards[targetIndex + 1]);
            } else {
              card.parentNode.insertBefore(card, cards[targetIndex]);
            }
          }
        }
      }
    };

    // Templates
    const templates = {
      startup: {
        'key-partners': 'Incubators, Mentors, Early Adopters, Tech Partners',
        'key-activities': 'Product Development, Market Research, Fundraising',
        'value-propositions': 'Innovative Solution, First Mover Advantage, Scalability',
        'customer-relationships': 'Direct Support, Community Building, Feedback Loops',
        'channels': 'Social Media, Demo Days, Networking Events',
        'revenue-streams': 'Seed Funding, Pre-sales, Grants',
        'cost-structure': 'Development Costs, Marketing, Team Salaries'
      },
      saas: {
        'key-partners': 'Cloud Providers, Payment Processors, Integration Partners',
        'key-activities': 'Software Development, Customer Support, Analytics',
        'value-propositions': 'Subscription Model, Regular Updates, 24/7 Support',
        'customer-relationships': 'Automated Support, Account Managers, Training',
        'channels': 'Website, App Stores, Partner Networks',
        'revenue-streams': 'Monthly Subscriptions, Annual Plans, Add-ons',
        'cost-structure': 'Hosting, Development, Customer Acquisition'
      },
      ecommerce: {
        'key-partners': 'Suppliers, Logistics, Payment Gateways',
        'key-activities': 'Inventory Management, Order Processing, Marketing',
        'value-propositions': 'Wide Selection, Fast Delivery, Competitive Prices',
        'customer-relationships': 'Loyalty Programs, Customer Service, Reviews',
        'channels': 'Website, Mobile App, Marketplaces',
        'revenue-streams': 'Product Sales, Premium Memberships, Advertising',
        'cost-structure': 'Inventory, Shipping, Platform Maintenance'
      }
    };

    document.getElementById('templateSelect').addEventListener('change', (e) => {
      const template = templates[e.target.value];
      if (template) {
        Object.entries(template).forEach(([id, content]) => {
          const card = document.querySelector(`.${id}`);
          if (card) {
            card.querySelector('p').textContent = content;
            if (isConnected) {
              ws.send(JSON.stringify({
                type: 'update',
                id,
                content
              }));
            }
          }
        });
        saveCanvasState();
      }
    });

    // Save canvas state to localStorage
    function saveCanvasState() {
      const cards = document.querySelectorAll('.card');
      const canvasState = Array.from(cards).map(card => ({
        id: card.className.split(' ')[1],
        content: card.querySelector('p').textContent
      }));
      localStorage.setItem('canvasState', JSON.stringify(canvasState));
      
      if (isConnected) {
        cards.forEach((card, index) => {
          ws.send(JSON.stringify({
            type: 'update',
            id: card.className.split(' ')[1],
            content: card.querySelector('p').textContent
          }));
        });
      }
    }

    // Load canvas state from localStorage
    function loadCanvasState() {
      const savedState = localStorage.getItem('canvasState');
      if (savedState) {
        const canvasState = JSON.parse(savedState);
        canvasState.forEach(state => {
          const card = document.querySelector(`.${state.id}`);
          if (card) {
            card.querySelector('p').textContent = state.content;
          }
        });
      }
    }

    // Export canvas as JSON
    document.getElementById('exportBtn').addEventListener('click', () => {
      const cards = document.querySelectorAll('.card');
      const canvasState = Array.from(cards).map(card => ({
        id: card.className.split(' ')[1],
        title: card.querySelector('h3').textContent,
        content: card.querySelector('p').textContent
      }));

      const blob = new Blob([JSON.stringify(canvasState, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'business-model-canvas.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // Import canvas from JSON
    document.getElementById('importBtn').addEventListener('click', () => {
      document.getElementById('importInput').click();
    });

    document.getElementById('importInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const canvasState = JSON.parse(event.target.result);
            canvasState.forEach(state => {
              const card = document.querySelector(`.${state.id}`);
              if (card) {
                card.querySelector('h3').textContent = state.title;
                card.querySelector('p').textContent = state.content;
              }
            });
            saveCanvasState();
          } catch (error) {
            alert('Invalid JSON file');
          }
        };
        reader.readAsText(file);
      }
    });

    // Drag and Drop functionality
    let draggedCard = null;

    document.querySelectorAll('.card').forEach(card => {
      card.addEventListener('dragstart', (e) => {
        draggedCard = card;
        card.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      });

      card.addEventListener('dragend', () => {
        card.classList.remove('dragging');
        draggedCard = null;
      });

      card.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
      });

      card.addEventListener('drop', (e) => {
        e.preventDefault();
        if (draggedCard !== card) {
          const cards = Array.from(document.querySelectorAll('.card'));
          const draggedIndex = cards.indexOf(draggedCard);
          const dropIndex = cards.indexOf(card);
          
          if (draggedIndex < dropIndex) {
            card.parentNode.insertBefore(draggedCard, card.nextSibling);
          } else {
            card.parentNode.insertBefore(draggedCard, card);
          }
          saveCanvasState();
          
          if (isConnected) {
            ws.send(JSON.stringify({
              type: 'reorder',
              id: draggedCard.className.split(' ')[1],
              index: dropIndex
            }));
          }
        }
      });
    });

    // Edit functionality
    document.querySelectorAll('.edit-btn').forEach(button => {
      button.addEventListener('click', function(e) {
        e.stopPropagation();
        const card = this.parentElement;
        const paragraph = card.querySelector('p');
        const currentText = paragraph.textContent;
        
        const input = document.createElement('textarea');
        input.value = currentText;
        input.style.width = '100%';
        input.style.height = '100px';
        input.style.margin = '10px 0';
        input.style.padding = '10px';
        input.style.borderRadius = '5px';
        input.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        input.style.color = '#fff';
        input.style.border = '1px solid rgba(255, 255, 255, 0.2)';
        
        paragraph.replaceWith(input);
        input.focus();
        
        const saveButton = document.createElement('button');
        saveButton.textContent = 'Save';
        saveButton.style.padding = '5px 15px';
        saveButton.style.margin = '5px';
        saveButton.style.borderRadius = '5px';
        saveButton.style.backgroundColor = '#00d4ff';
        saveButton.style.color = '#fff';
        saveButton.style.border = 'none';
        saveButton.style.cursor = 'pointer';
        
        this.replaceWith(saveButton);
        
        saveButton.addEventListener('click', () => {
          const newParagraph = document.createElement('p');
          newParagraph.textContent = input.value;
          input.replaceWith(newParagraph);
          saveButton.replaceWith(this);
          validateCard(card);
          saveCanvasState();
          
          if (isConnected) {
            ws.send(JSON.stringify({
              type: 'update',
              id: card.className.split(' ')[1],
              content: input.value
            }));
          }
        });
      });
    });

    // Validate all cards on load
    document.querySelectorAll('.card').forEach(validateCard);

    // Validation rules
    const validationRules = {
      'key-partners': { minItems: 3 },
      'key-activities': { minItems: 3 },
      'value-propositions': { minItems: 2 },
      'customer-relationships': { minItems: 2 },
      'channels': { minItems: 2 },
      'revenue-streams': { minItems: 2 },
      'cost-structure': { minItems: 3 }
    };

    // Analytics functions
    function analyzeCanvas() {
      const cards = document.querySelectorAll('.card');
      const completenessData = [];
      const wordCountData = [];

      cards.forEach(card => {
        const id = card.className.split(' ')[1];
        const content = card.querySelector('p').textContent;
        const items = content.split(',').map(item => item.trim()).filter(item => item);
        
        // Calculate completeness
        const rule = validationRules[id];
        const completeness = Math.min(100, (items.length / rule.minItems) * 100);
        completenessData.push({
          label: card.querySelector('h3').textContent,
          value: completeness
        });

        // Calculate word count
        const words = content.split(/\s+/).filter(word => word.length > 0);
        wordCountData.push({
          label: card.querySelector('h3').textContent,
          value: words.length
        });
      });

      // Update charts
      updateCompletenessChart(completenessData);
      updateWordCountChart(wordCountData);
      document.getElementById('analyticsPanel').style.display = 'block';
    }

    function updateCompletenessChart(data) {
      const ctx = document.getElementById('completenessChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.map(d => d.label),
          datasets: [{
            label: 'Completeness (%)',
            data: data.map(d => d.value),
            backgroundColor: 'rgba(0, 212, 255, 0.5)',
            borderColor: '#00d4ff',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 100
            }
          }
        }
      });
    }

    function updateWordCountChart(data) {
      const ctx = document.getElementById('wordCountChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map(d => d.label),
          datasets: [{
            label: 'Word Count',
            data: data.map(d => d.value),
            borderColor: '#00d4ff',
            tension: 0.1
          }]
        },
        options: {
          responsive: true
        }
      });
    }

    // Validation function
    function validateCard(card) {
      const id = card.className.split(' ')[1];
      const content = card.querySelector('p').textContent;
      const items = content.split(',').map(item => item.trim()).filter(item => item);
      const rule = validationRules[id];

      if (items.length < rule.minItems) {
        card.classList.add('invalid');
      } else {
        card.classList.remove('invalid');
      }
    }

    // Export to PDF
    document.getElementById('exportPdfBtn').addEventListener('click', async () => {
      const canvas = document.querySelector('.canvas-container');
      const canvasImage = await html2canvas(canvas);
      
      const pdf = new jspdf.jsPDF({
        orientation: 'landscape',
        unit: 'mm'
      });

      const imgWidth = 297; // A4 width in mm
      const imgHeight = (canvasImage.height * imgWidth) / canvasImage.width;

      pdf.addImage(canvasImage.toDataURL('image/png'), 'PNG', 0, 0, imgWidth, imgHeight);
      pdf.save('business-model-canvas.pdf');
    });

    // Analyze button click handler
    document.getElementById('analyzeBtn').addEventListener('click', analyzeCanvas);

    // Load saved state on page load
    loadCanvasState();

    // Gemini API Integration
    const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY'; // Replace with your actual API key
    const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

    async function getGeminiSuggestions(prompt) {
      try {
        const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }]
          })
        });

        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
      } catch (error) {
        console.error('Error getting Gemini suggestions:', error);
        return 'Error getting suggestions. Please try again.';
      }
    }

    function formatSuggestions(text) {
      return text.split('\n')
        .filter(line => line.trim())
        .map(line => {
          const item = document.createElement('div');
          item.className = 'suggestion-item';
          item.textContent = line.trim();
          return item;
        });
    }

    async function generateSuggestions() {
      const canvasData = {};
      document.querySelectorAll('.card').forEach(card => {
        const id = card.className.split(' ')[1];
        const content = card.querySelector('p').textContent;
        canvasData[id] = content;
      });

      const businessType = document.getElementById('templateSelect').value || 'general';
      
      const businessTypePrompts = {
        'startup': {
          'key-partners': `As a startup, suggest 5 strategic partners that could accelerate growth. Current partners: ${canvasData['key-partners']}. Focus on incubators, accelerators, and early-stage investors.`,
          'key-activities': `For a startup, suggest 5 key activities to establish market presence. Current activities: ${canvasData['key-activities']}. Consider MVP development and market validation.`,
          'value-propositions': `Suggest 5 unique value propositions for a startup. Current propositions: ${canvasData['value-propositions']}. Focus on innovation and market disruption.`,
          'customer-relationships': `Propose 5 ways to build early customer relationships. Current relationships: ${canvasData['customer-relationships']}. Consider beta testing and community building.`,
          'channels': `Suggest 5 channels for a startup to reach early adopters. Current channels: ${canvasData['channels']}. Focus on digital and growth hacking strategies.`,
          'revenue-streams': `Propose 5 revenue streams suitable for a startup. Current streams: ${canvasData['revenue-streams']}. Consider freemium and subscription models.`,
          'cost-structure': `Suggest 5 cost categories for a lean startup. Current costs: ${canvasData['cost-structure']}. Focus on essential and scalable costs.`
        },
        'saas': {
          'key-partners': `For a SaaS business, suggest 5 strategic partners. Current partners: ${canvasData['key-partners']}. Focus on cloud providers and integration partners.`,
          'key-activities': `Suggest 5 key activities for a SaaS company. Current activities: ${canvasData['key-activities']}. Consider software development and customer success.`,
          'value-propositions': `Propose 5 value propositions for a SaaS business. Current propositions: ${canvasData['value-propositions']}. Focus on scalability and automation.`,
          'customer-relationships': `Suggest 5 ways to maintain SaaS customer relationships. Current relationships: ${canvasData['customer-relationships']}. Consider onboarding and support.`,
          'channels': `Propose 5 channels for a SaaS business. Current channels: ${canvasData['channels']}. Focus on digital marketing and partnerships.`,
          'revenue-streams': `Suggest 5 revenue streams for a SaaS model. Current streams: ${canvasData['revenue-streams']}. Consider tiered pricing and add-ons.`,
          'cost-structure': `Propose 5 cost categories for a SaaS business. Current costs: ${canvasData['cost-structure']}. Focus on infrastructure and development.`
        },
        'ecommerce': {
          'key-partners': `For an e-commerce business, suggest 5 strategic partners. Current partners: ${canvasData['key-partners']}. Focus on suppliers and logistics providers.`,
          'key-activities': `Suggest 5 key activities for e-commerce. Current activities: ${canvasData['key-activities']}. Consider inventory and order management.`,
          'value-propositions': `Propose 5 value propositions for e-commerce. Current propositions: ${canvasData['value-propositions']}. Focus on convenience and selection.`,
          'customer-relationships': `Suggest 5 ways to build e-commerce customer relationships. Current relationships: ${canvasData['customer-relationships']}. Consider loyalty programs.`,
          'channels': `Propose 5 channels for an e-commerce business. Current channels: ${canvasData['channels']}. Focus on online marketplaces and social media.`,
          'revenue-streams': `Suggest 5 revenue streams for e-commerce. Current streams: ${canvasData['revenue-streams']}. Consider cross-selling and premium services.`,
          'cost-structure': `Propose 5 cost categories for e-commerce. Current costs: ${canvasData['cost-structure']}. Focus on fulfillment and marketing.`
        },
        'general': {
          'key-partners': `Analyze the current business model canvas and suggest 5 additional strategic partners that could enhance the business. Current partners: ${canvasData['key-partners']}. Focus on complementary businesses and potential synergies.`,
          'key-activities': `Based on the business model canvas, suggest 5 additional key activities that could strengthen the business operations. Current activities: ${canvasData['key-activities']}. Consider both core and supporting activities.`,
          'value-propositions': `Suggest 5 new value propositions that could differentiate the business in the market. Current propositions: ${canvasData['value-propositions']}. Focus on unique benefits and customer pain points.`,
          'customer-relationships': `Propose 5 innovative ways to build and maintain customer relationships. Current relationships: ${canvasData['customer-relationships']}. Consider both digital and traditional approaches.`,
          'channels': `Suggest 5 additional channels to reach and serve customers. Current channels: ${canvasData['channels']}. Include both direct and indirect distribution methods.`,
          'revenue-streams': `Propose 5 new potential revenue streams for the business. Current streams: ${canvasData['revenue-streams']}. Consider both recurring and one-time revenue models.`,
          'cost-structure': `Suggest 5 additional cost categories to consider in the business model. Current costs: ${canvasData['cost-structure']}. Include both fixed and variable costs.`
        }
      };

      const prompts = businessTypePrompts[businessType];
      const suggestions = {};

      // Show loading state
      document.getElementById('suggestionsPanel').style.display = 'block';
      document.getElementById('suggestionsPanel').innerHTML = '<h2>Generating AI Suggestions...</h2>';

      for (const [id, prompt] of Object.entries(prompts)) {
        try {
          suggestions[id] = await getGeminiSuggestions(prompt);
        } catch (error) {
          console.error(`Error getting suggestions for ${id}:`, error);
          suggestions[id] = 'Error generating suggestions. Please try again.';
        }
      }

      // Update UI with suggestions
      document.getElementById('suggestionsPanel').innerHTML = '<h2>AI Suggestions</h2><div class="suggestions-container"></div>';
      const container = document.querySelector('.suggestions-container');

      Object.entries(suggestions).forEach(([id, text]) => {
        const suggestionCard = document.createElement('div');
        suggestionCard.className = 'suggestion-card';
        suggestionCard.innerHTML = `
          <h3>${id.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')} Suggestions</h3>
          <div class="suggestion-content" id="${id}Suggestions"></div>
        `;
        container.appendChild(suggestionCard);

        const contentContainer = document.getElementById(`${id}Suggestions`);
        formatSuggestions(text).forEach(item => {
          item.addEventListener('click', () => {
            const card = document.querySelector(`.${id}`);
            const paragraph = card.querySelector('p');
            const currentContent = paragraph.textContent;
            const newContent = currentContent ? `${currentContent}, ${item.textContent}` : item.textContent;
            paragraph.textContent = newContent;
            validateCard(card);
            saveCanvasState();
          });
          contentContainer.appendChild(item);
        });
      });
    }

    // Suggestions button click handler
    document.getElementById('suggestionsBtn').addEventListener('click', generateSuggestions);

    // Learning panel functionality
    document.getElementById('learnBtn').addEventListener('click', () => {
      const panel = document.getElementById('learningPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    });

    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons and contents
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to clicked button and corresponding content
        button.classList.add('active');
        const tabId = button.dataset.tab;
        document.getElementById(tabId).classList.add('active');
        document.getElementById(button.dataset.tab).classList.add('active');
      });
    });

    // Quiz functionality
    document.getElementById('submitQuiz').addEventListener('click', () => {
      const answers = {
        q1: 'b',
        q2: 'a'
      };
      
      let score = 0;
      let total = Object.keys(answers).length;
      
      Object.keys(answers).forEach(question => {
        const selected = document.querySelector(`input[name="${question}"]:checked`);
        if (selected && selected.value === answers[question]) {
          score++;
        }
      });
      
      alert(`You scored ${score} out of ${total}!`);
    });

    // Add tooltips to canvas sections
    document.querySelectorAll('.card').forEach(card => {
      const title = card.querySelector('h3').textContent;
      const guide = document.querySelector(`.guide-item h5:contains('${title}')`)?.parentElement;
      if (guide) {
        card.title = guide.querySelector('p').textContent;
      }
    });

    async function generateAnalysisReport() {
      const canvasData = {};
      document.querySelectorAll('.card').forEach(card => {
        const id = card.className.split(' ')[1];
        const content = card.querySelector('p').textContent;
        canvasData[id] = content;
      });

      const businessType = document.getElementById('templateSelect').value || 'general';
      
      // Show loading state
      document.getElementById('analyticsPanel').style.display = 'block';
      const reportSections = document.querySelectorAll('.report-content');
      reportSections.forEach(section => {
        section.innerHTML = '<div class="loading"></div>';
      });

      try {
        // Generate comprehensive analysis
        const analysisPrompts = {
          businessOverview: `Provide a detailed overview of this business model. Focus on the business type (${businessType}), its core value proposition, and main revenue streams. Include a viability score (1-10). Canvas data: ${JSON.stringify(canvasData)}`,
          industryAnalysis: `Analyze the industry context for this business model. Consider market size, growth trends, and key industry drivers. Canvas data: ${JSON.stringify(canvasData)}`,
          strengthsOpportunities: `Identify and analyze the key strengths and opportunities in this business model. Consider the value propositions, customer relationships, and revenue streams. Canvas data: ${JSON.stringify(canvasData)}`,
          weaknessesThreats: `Analyze potential weaknesses and threats in this business model. Consider the cost structure, key activities, and channels. Canvas data: ${JSON.stringify(canvasData)}`,
          marketAnalysis: `Provide a detailed market analysis based on the business model canvas. Consider target market segments, customer needs, and market trends. Canvas data: ${JSON.stringify(canvasData)}`,
          competitiveAnalysis: `Analyze the competitive landscape for this business model. Identify key competitors and competitive advantages. Canvas data: ${JSON.stringify(canvasData)}`,
          financialViability: `Assess the financial viability of this business model. Consider revenue streams, cost structure, and potential profitability. Canvas data: ${JSON.stringify(canvasData)}`,
          sentimentAnalysis: `Perform a detailed sentiment analysis of this business model. Evaluate overall viability, innovation level, and market potential. Include a sentiment score (-100 to 100). Canvas data: ${JSON.stringify(canvasData)}`,
          riskAssessment: `Analyze the risks associated with this business model. Consider market risks, operational risks, and financial risks. Include a risk level (low/medium/high). Canvas data: ${JSON.stringify(canvasData)}`,
          recommendations: `Based on the complete analysis, provide detailed, actionable recommendations for improving the business model. Canvas data: ${JSON.stringify(canvasData)}`
        };

        // Generate analysis for each section
        for (const [section, prompt] of Object.entries(analysisPrompts)) {
          const response = await getGeminiSuggestions(prompt);
          const formattedResponse = formatAnalysis(response);
          document.getElementById(section).innerHTML = formattedResponse;
          
          // Add visual indicators for scores and risks
          if (section === 'sentimentAnalysis') {
            const sentimentScore = extractScore(response, -100, 100);
            addSentimentBar(sentimentScore, section);
          } else if (section === 'riskAssessment') {
            const riskLevel = extractRiskLevel(response);
            addRiskIndicator(riskLevel, section);
          }
        }

        // Generate charts
        analyzeCanvas();
      } catch (error) {
        console.error('Error generating analysis:', error);
        reportSections.forEach(section => {
          section.innerHTML = 'Error generating analysis. Please try again.';
        });
      }
    }

    function extractScore(text, min, max) {
      const match = text.match(/(\d+)/);
      return match ? Math.min(max, Math.max(min, parseInt(match[1]))) : 0;
    }

    function extractRiskLevel(text) {
      if (text.toLowerCase().includes('high')) return 'high';
      if (text.toLowerCase().includes('medium')) return 'medium';
      return 'low';
    }

    function addSentimentBar(score, sectionId) {
      const container = document.getElementById(sectionId);
      const bar = document.createElement('div');
      bar.className = 'sentiment-bar';
      const fill = document.createElement('div');
      fill.className = 'sentiment-fill';
      fill.style.width = `${((score + 100) / 200) * 100}%`;
      bar.appendChild(fill);
      container.appendChild(bar);
    }

    function addRiskIndicator(level, sectionId) {
      const section = document.getElementById(sectionId).parentElement;
      const indicator = document.createElement('div');
      indicator.className = `risk-indicator risk-${level}`;
      section.appendChild(indicator);
    }

    function formatAnalysis(text) {
      return text.split('\n')
        .filter(line => line.trim())
        .map(line => `<p>${line.trim()}</p>`)
        .join('');
    }

    // Export report functionality
    document.getElementById('exportReportBtn').addEventListener('click', async () => {
      const report = document.getElementById('analysisReport').innerHTML;
      const canvas = await html2canvas(document.querySelector('.canvas-container'));
      
      const pdf = new jspdf.jsPDF({
        orientation: 'portrait',
        unit: 'mm'
      });

      // Add canvas image
      const imgWidth = 190; // A4 width in mm
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 10, 10, imgWidth, imgHeight);

      // Add report content
      pdf.setFontSize(12);
      pdf.text('Business Model Analysis Report', 10, imgHeight + 20);
      
      const reportSections = document.querySelectorAll('.report-section');
      let yPosition = imgHeight + 30;
      
      reportSections.forEach(section => {
        const title = section.querySelector('h4').textContent;
        const content = section.querySelector('.report-content').textContent;
        
        pdf.setFontSize(10);
        pdf.text(title, 10, yPosition);
        yPosition += 10;
        
        pdf.setFontSize(8);
        const splitText = pdf.splitTextToSize(content, 190);
        pdf.text(splitText, 10, yPosition);
        yPosition += splitText.length * 5 + 10;
      });

      pdf.save('business-model-analysis.pdf');
    });

    // Refresh analysis button
    document.getElementById('refreshAnalysisBtn').addEventListener('click', generateAnalysisReport);

    // Gamification system
    const achievements = {
      'first-steps': {
        title: 'First Steps',
        description: 'Complete your first business model canvas',
        icon: '🚀',
        progress: 0,
        required: 1,
        reward: 100,
        badge: 'newbie'
      },
      'detail-oriented': {
        title: 'Detail Oriented',
        description: 'Fill all sections with detailed information',
        icon: '📝',
        progress: 0,
        required: 1,
        reward: 200,
        badge: 'perfectionist'
      },
      'analyst': {
        title: 'Business Analyst',
        description: 'Generate 5 analysis reports',
        icon: '📊',
        progress: 0,
        required: 5,
        reward: 300,
        badge: 'analyst'
      },
      'innovator': {
        title: 'Innovator',
        description: 'Create 3 unique business models',
        icon: '💡',
        progress: 0,
        required: 3,
        reward: 400,
        badge: 'innovator'
      },
      'expert': {
        title: 'Business Expert',
        description: 'Score above 80% in all analysis sections',
        icon: '🏆',
        progress: 0,
        required: 1,
        reward: 500,
        badge: 'expert'
      },
      'quick-learner': {
        title: 'Quick Learner',
        description: 'Complete all learning modules in one day',
        icon: '⚡',
        progress: 0,
        required: 1,
        reward: 250,
        badge: 'fast-learner'
      },
      'community-builder': {
        title: 'Community Builder',
        description: 'Share 5 business models with the community',
        icon: '🤝',
        progress: 0,
        required: 5,
        reward: 350,
        badge: 'connector'
      },
      'master-strategist': {
        title: 'Master Strategist',
        description: 'Create a business model with all sections scoring 90%+',
        icon: '🎯',
        progress: 0,
        required: 1,
        reward: 600,
        badge: 'strategist'
      }
    };

    const levels = [
      { level: 1, xp: 0, title: 'Novice' },
      { level: 2, xp: 500, title: 'Apprentice' },
      { level: 3, xp: 1000, title: 'Professional' },
      { level: 4, xp: 2000, title: 'Expert' },
      { level: 5, xp: 4000, title: 'Master' }
    ];

    // Enhanced Learning System
    const learningModules = {
      'overview': {
        title: 'Business Model Canvas Overview',
        content: [
          {
            type: 'text',
            content: 'Learn the fundamentals of the Business Model Canvas'
          },
          {
            type: 'video',
            url: 'https://www.youtube.com/embed/QoAOzMTLP5s'
          },
          {
            type: 'quiz',
            questions: [
              {
                question: 'What is the purpose of the Business Model Canvas?',
                options: [
                  'To track daily expenses',
                  'To visualize and document business models',
                  'To manage employee schedules'
                ],
                answer: 1
              }
            ]
          }
        ]
      },
      'key-partners': {
        title: 'Key Partners Module',
        content: [
          {
            type: 'text',
            content: 'Understanding strategic partnerships'
          },
          {
            type: 'case-study',
            content: 'Analyze successful partnership models'
          },
          {
            type: 'interactive',
            content: 'Build your own partnership strategy'
          }
        ]
      }
    };

    // Enhanced Quiz System
    const quizzes = {
      'basic': {
        title: 'Basic BMC Knowledge',
        questions: [
          {
            question: 'What is the purpose of the Key Partners section?',
            options: [
              'To list all suppliers',
              'To identify strategic alliances',
              'To track customer relationships'
            ],
            answer: 1,
            explanation: 'Key Partners focuses on strategic alliances that help create value'
          },
          {
            question: 'Which section focuses on how you deliver value to customers?',
            options: [
              'Value Propositions',
              'Revenue Streams',
              'Customer Relationships'
            ],
            answer: 0,
            explanation: 'Value Propositions describe the bundle of products and services that create value'
          }
        ]
      },
      'advanced': {
        title: 'Advanced BMC Concepts',
        questions: [
          {
            question: 'What is the relationship between Value Propositions and Customer Segments?',
            options: [
              'They are independent',
              'Value Propositions should match Customer Segments',
              'Customer Segments determine Revenue Streams'
            ],
            answer: 1,
            explanation: 'Value Propositions must align with the needs of specific Customer Segments'
          }
        ]
      }
    };

    // Enhanced Progress Tracking
    function updateProgress() {
      const progress = {
        learning: calculateLearningProgress(),
        achievements: calculateAchievementProgress(),
        level: calculateLevel(),
        badges: collectBadges()
      };
      
      saveProgress(progress);
      updateUI(progress);
    }

    function calculateLearningProgress() {
      let completed = 0;
      let total = 0;
      
      Object.values(learningModules).forEach(module => {
        module.content.forEach(item => {
          total++;
          if (item.completed) completed++;
        });
      });
      
      return (completed / total) * 100;
    }

    function calculateAchievementProgress() {
      let completed = 0;
      let total = Object.keys(achievements).length;
      
      Object.values(achievements).forEach(achievement => {
        if (achievement.progress >= achievement.required) completed++;
      });
      
      return (completed / total) * 100;
    }

    function calculateLevel() {
      const currentXP = getCurrentXP();
      return levels.reduce((current, level) => {
        return currentXP >= level.xp ? level : current;
      }, levels[0]);
    }

    function collectBadges() {
      return Object.values(achievements)
        .filter(achievement => achievement.progress >= achievement.required)
        .map(achievement => achievement.badge);
    }

    function saveProgress(progress) {
      localStorage.setItem('userProgress', JSON.stringify(progress));
    }

    function updateUI(progress) {
      // Update level display
      document.getElementById('userLevel').textContent = progress.level.title;
      document.getElementById('userXP').textContent = getCurrentXP();
      
      // Update progress bars
      document.getElementById('learningProgress').style.width = `${progress.learning}%`;
      document.getElementById('achievementProgress').style.width = `${progress.achievements}%`;
      
      // Update badges
      const badgesContainer = document.getElementById('badgesContainer');
      badgesContainer.innerHTML = progress.badges
        .map(badge => `<div class="badge">${badge}</div>`)
        .join('');
    }

    // Enhanced Learning Experience
    function startLearningModule(moduleId) {
      const module = learningModules[moduleId];
      const container = document.getElementById('learningContent');
      
      container.innerHTML = `
        <h2>${module.title}</h2>
        <div class="module-progress">
          <div class="progress-bar">
            <div class="progress-fill" style="width: 0%"></div>
          </div>
        </div>
      `;
      
      module.content.forEach((item, index) => {
        const element = createLearningElement(item, index);
        container.appendChild(element);
      });
    }

    function createLearningElement(item, index) {
      const element = document.createElement('div');
      element.className = 'learning-item';
      
      switch (item.type) {
        case 'text':
          element.innerHTML = `<p>${item.content}</p>`;
          break;
        case 'video':
          element.innerHTML = `
            <iframe width="100%" height="315" src="${item.url}" frameborder="0" allowfullscreen></iframe>
          `;
          break;
        case 'quiz':
          element.innerHTML = createQuizHTML(item.questions);
          break;
        case 'case-study':
          element.innerHTML = createCaseStudyHTML(item.content);
          break;
        case 'interactive':
          element.innerHTML = createInteractiveHTML(item.content);
          break;
      }
      
      return element;
    }

    function createQuizHTML(questions) {
      return `
        <div class="quiz-container">
          ${questions.map((q, i) => `
            <div class="quiz-question">
              <p>${i + 1}. ${q.question}</p>
              <div class="quiz-options">
                ${q.options.map((opt, j) => `
                  <label>
                    <input type="radio" name="q${i}" value="${j}">
                    ${opt}
                  </label>
                `).join('')}
              </div>
              <div class="explanation" style="display: none;">
                ${q.explanation}
              </div>
            </div>
          `).join('')}
          <button class="btn" onclick="submitQuiz(this)">Submit Answers</button>
        </div>
      `;
    }

    // ... existing code ...

    // Welcome popup functionality
    const welcomePopup = document.getElementById('welcomePopup');
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');

    function hideWelcomePopup() {
      welcomePopup.style.animation = 'popIn 0.5s ease reverse';
      overlay.style.opacity = '0';
      setTimeout(() => {
        welcomePopup.style.display = 'none';
        overlay.style.display = 'none';
      }, 500);
    }

    startBtn.addEventListener('click', hideWelcomePopup);

    // Show popup on first visit
    if (!localStorage.getItem('welcomeShown')) {
      welcomePopup.style.display = 'block';
      overlay.style.display = 'block';
      localStorage.setItem('welcomeShown', 'true');
    } else {
      welcomePopup.style.display = 'none';
      overlay.style.display = 'none';
    }
  </script>
</body>

</html>